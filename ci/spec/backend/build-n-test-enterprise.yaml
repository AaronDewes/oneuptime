build_n_test_enterprise_backend:
  stage: BuildAndTest
  script:
    - curl -sSL https://get.docker.com/ | sh #Install docker.
    - sudo docker stop $(sudo docker ps -aq) || echo 'No docker containers'
    - sudo docker rm $(sudo docker ps -aq) || echo 'No docker containers'
    - sudo docker run --name mongo -p 27017:27017 -d mongo:4.2.3
    - sudo docker run --name redis -p 6379:6379 -d redis:5.0.7 redis-server
    - sudo docker build -t fyipeproject/backend:3.0.$CI_PIPELINE_IID ./backend
    - sudo docker ps
    - sudo docker run --name fyipe --env-file ./backend/.env --net=host fyipeproject/backend:3.0.$CI_PIPELINE_IID npm run enterprise-test
  except:
    refs:
      - hotfix-master
      - hotfix-release