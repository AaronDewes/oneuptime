## DEPLOYMENT STAGE - Log JS
deploy_staging_log-js:
    stage: Deploy
    allow_failure: true
    script:
        - sudo apt-get update
        - sudo apt-get install -y curl gcc
        - sudo apt-get install -y build-essential
        - curl -sL https://deb.nodesource.com/setup_12.x | sudo -E bash -
        - sudo apt-get install -y nodejs
        - cd log-js
        - sudo npm install -g json
        - chmod +x ../ci/scripts/version-setup.sh
        - ../ci/scripts/version-setup.sh
        - json -I -f package.json -e 'this.name="fyipe-log-js-staging"'
        - echo "//registry.npmjs.org/:_authToken=$NPM_AUTH_TOKEN" > ~/.npmrc
        - npm publish
        - git init
        - git add .
        - git commit -m "staging commit version 3.0.$CI_PIPELINE_IID"
        - git checkout staging || git checkout -b staging
        - git push https://$GITHUB_USERNAME:$GITHUB_PASSWORD@github.com/Fyipe/log-js.git staging --force
        - cd ..
    only:
        refs:
            - master
            - hotfix-master
            - feature-log-js
    environment:
        name: staging

deploy_production_log-js:
    stage: Deploy
    script:
        - sudo apt-get update
        - sudo apt-get install -y curl gcc
        - sudo apt-get install -y build-essential
        - curl -sL https://deb.nodesource.com/setup_12.x | sudo -E bash -
        - sudo apt-get install -y nodejs
        - cd log-js
        - sudo npm install -g json
        - git checkout -f master
        - chmod +x ../ci/scripts/version-setup.sh
        - ../ci/scripts/version-setup.sh
        - json -I -f package.json -e 'this.name="fyipe-log-js"'
        - echo "//registry.npmjs.org/:_authToken=$NPM_AUTH_TOKEN" > ~/.npmrc
        - npm publish
        - git add .
        - git commit -m "production commit version 3.0.$CI_PIPELINE_IID"
        - git push https://$GITHUB_USERNAME:$GITHUB_PASSWORD@github.com/Fyipe/log-js.git master --force
        - cd ..
    only:
        refs:
            - release
            - hotfix-release
            - feature-log-js
    environment:
        name: production
