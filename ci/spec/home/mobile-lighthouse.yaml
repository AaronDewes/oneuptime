## Lighouse for the mobile version of the home pages.
mobile_lighthouse_home:
  stage: BuildAndTest
  allow_failure: true
  script:
    - chmod +x ./ci/scripts/setup-docker.sh
    - ./ci/scripts/setup-docker.sh
    - echo "Setup machine for running lighthouse on home page"
    - sudo docker stop $(sudo docker ps -aq) || echo 'No docker containers'
    - sudo docker rm $(sudo docker ps -aq) || echo 'No docker containers'
    - sudo docker build -t fyipeproject/home:3.0.$CI_PIPELINE_IID ./home
    - sudo docker run -p 1444:1444 -d fyipeproject/home:3.0.$CI_PIPELINE_IID
    - sudo docker ps
    - cd home
    - npm ci
    - export CHROME_PATH="$(pwd)/node_modules/puppeteer/.local-chromium/linux-686378/chrome-linux/chrome"
    - npm run light-house-mobile
  except:
    refs:
      - hotfix-master
      - hotfix-release